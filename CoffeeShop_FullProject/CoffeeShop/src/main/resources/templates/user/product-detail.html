<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Chi ti·∫øt s·∫£n ph·∫©m</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>
        body {
            background-color: #f3ede3;
            font-family: 'Segoe UI', sans-serif;
        }

        .product-img {
            width: 100%;
            height: 350px;
            object-fit: cover;
            border-radius: 14px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .related-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            overflow: hidden;
        }
    </style>
</head>

<body>

<!-- ‚≠ê‚≠ê NAVBAR ‚≠ê‚≠ê -->
<div th:replace="layout/navbar :: navbar"></div>

<div class="container mt-4">

    <a href="/products" class="btn btn-secondary mb-3">‚¨Ö Tr·ªü v·ªÅ</a>

    <div class="row">

        <!-- ·∫¢NH -->
        <div class="col-md-5">
            <img th:src="@{'/img/' + ${product.image}}"
                 class="product-img">
        </div>

        <!-- TH√îNG TIN -->
        <div class="col-md-7">
            <h2 th:text="${product.name}"></h2>

            <h4 class="text-danger fw-bold"
                th:text="${product.price} + ' ƒë'"></h4>

            <p class="mt-3" th:text="${product.description}"></p>

            <!-- =================== FORM TH√äM GI·ªé H√ÄNG =================== -->
            <form th:action="@{/cart/add}" method="post" class="mt-3">

                <input type="hidden" name="productId" th:value="${product.id}">
                <input type="hidden" name="quantity" value="1">

                <!-- SIZE -->
                <label class="mt-2">Size</label>
                <select name="size" class="form-select">
                    <option value="M">Size M</option>
                    <option value="L">Size L (+6.000ƒë)</option>
                </select>

                <!-- ƒê∆Ø·ªúNG -->
                <label class="mt-3">ƒê·ªô ng·ªçt</label>
                <select name="sugar" class="form-select">
                    <option>0%</option>
                    <option>50%</option>
                    <option selected>100%</option>
                </select>

                <!-- ƒê√Å -->
                <label class="mt-3">ƒê√°</label>
                <select name="ice" class="form-select">
                    <option>Kh√¥ng ƒë√°</option>
                    <option>√çt ƒë√°</option>
                    <option selected>B√¨nh th∆∞·ªùng</option>
                    <option>Nhi·ªÅu ƒë√°</option>
                </select>

                <!-- TOPPING -->
                <label class="mt-3">Topping</label>
                <div th:each="t : ${toppings}">
                    <label class="form-check-label">
                        <input class="form-check-input" type="checkbox"
                               name="toppingIds"
                               th:value="${t.id}">
                        <span th:text="${t.name}"></span>
                        (+<span th:text="${t.price}"></span> ƒë)
                    </label>
                    <br/>
                </div>

                <button type="submit"
                        class="btn btn-lg mt-3"
                        style="background:#6d4c41;color:white;">
                    üõí Th√™m v√†o gi·ªè h√†ng
                </button>

            </form>
            <!-- ================= END FORM ================= -->

        </div>

    </div>

    <!-- ==================== S·∫¢N PH·∫®M LI√äN QUAN ==================== -->
    <h4 class="mt-5">S·∫£n ph·∫©m li√™n quan</h4>

    <div class="row mt-3" th:if="${related != null}">
        <div class="col-md-3 mb-4" th:each="r : ${related}">
            <div class="related-card">

                <img th:src="@{'/img/' + ${r.image}}"
                     style="width:100%;height:180px;object-fit:cover;">

                <div class="p-2">
                    <h6 th:text="${r.name}"></h6>

                    <p class="text-danger fw-bold"
                       th:text="${r.price} + ' ƒë'"></p>

                    <a th:href="@{/product/{id}(id=${r.id})}"
                       class="btn btn-sm"
                       style="background:#6d4c41;color:white;width:100%;">
                        Xem chi ti·∫øt
                    </a>
                </div>

            </div>
        </div>
    </div>

</div>

<!-- ==================== ƒê√ÅNH GI√Å S·∫¢N PH·∫®M ==================== -->
<div class="container mt-5" id="review-section">

    <h3 class="mb-4">üí¨ ƒê√°nh gi√° s·∫£n ph·∫©m</h3>

    <!-- TH√îNG TIN SAO TRUNG B√åNH -->
    <div class="mb-3">
        <strong>ƒêi·ªÉm trung b√¨nh: </strong>

        <span th:each="i : ${#numbers.sequence(1,5)}">
            <span th:text="${i <= avgRating} ? '‚≠ê' : '‚òÜ'" style="font-size:22px;"></span>
        </span>

        <span class="text-muted ms-2" th:text="'(' + ${reviewCount} + ' ƒë√°nh gi√°)'"></span>
    </div>

    <hr>

    <!-- FORM G·ª¨I ƒê√ÅNH GI√Å -->
    <h5 class="mt-4">Vi·∫øt ƒë√°nh gi√°</h5>

    <form action="/review/add" method="post" class="mb-4">

        <input type="hidden" name="productId" th:value="${product.id}">

        <label class="mt-2">S·ªë sao</label>
        <select name="rating" class="form-select w-25 mb-2">
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - Tuy·ªát v·ªùi</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê - Ngon</option>
            <option value="3">‚≠ê‚≠ê‚≠ê - T·∫°m ·ªïn</option>
            <option value="2">‚≠ê‚≠ê - Kh√¥ng ngon l·∫Øm</option>
            <option value="1">‚≠ê - T·ªá</option>
        </select>

        <textarea name="comment"
                  class="form-control mb-2"
                  rows="3"
                  placeholder="C·∫£m nh·∫≠n c·ªßa b·∫°n v·ªÅ s·∫£n ph·∫©m..."></textarea>

        <button type="submit"
                class="btn"
                style="background:#6d4c41;color:white;">
            G·ª≠i ƒë√°nh gi√°
        </button>
    </form>

    <hr>

    <!-- DANH S√ÅCH C√ÅC ƒê√ÅNH GI√Å -->
    <div th:if="${#lists.isEmpty(reviews)}">
        <p class="text-muted">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>
    </div>

    <div th:if="${!#lists.isEmpty(reviews)}">
        <div th:each="rv : ${reviews}" class="p-3 mb-3"
             style="background:white;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);">

            <!-- S·ªë sao -->
            <div>
                <span th:each="i : ${#numbers.sequence(1, rv.rating)}" style="font-size:20px;">‚≠ê</span>
            </div>

            <!-- N·ªôi dung b√¨nh lu·∫≠n -->
            <p class="mt-2 mb-1" th:text="${rv.comment}"></p>

            <!-- Ng∆∞·ªùi b√¨nh lu·∫≠n -->
            <small class="fw-semibold" th:text="${rv.user.fullName}"></small>

            <!-- Th·ªùi gian -->
            <br>
            <small class="text-muted"
                   th:text="${#temporals.format(rv.createdAt, 'dd/MM/yyyy HH:mm')}"></small>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
