<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Chi ti·∫øt s·∫£n ph·∫©m</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>

        body {
            background:#faf7f1;
            font-family:"Courier New", monospace;
            color:#3b372f;
        }

        /* ===== PRODUCT IMAGE ===== */
        .product-img {
            width:100%;
            height:360px;
            object-fit:cover;
            border-radius:18px;
            border:1px solid #e6ddc8;
            box-shadow:0 8px 20px rgba(0,0,0,.15);
            transition:.25s ease;
        }
        .product-img:hover {
            transform:translateY(-4px);
        }

        /* ===== MAIN BOX ===== */
        .product-box {
            background:white;
            padding:25px;
            border-radius:20px;
            border:1px solid #e6ddc8;
            box-shadow:0 8px 25px rgba(0,0,0,.15);
        }

        h2 {
            font-weight:800;
            color:#3d4f37;
        }

        h4 {
            font-size:26px;
            font-weight:900;
            color:#a6281b;
        }

        .btn-coffee {
            background:#415738;
            color:white;
            font-weight:700;
            padding:10px 20px;
            border-radius:12px;
            transition:.25s ease;
            letter-spacing:1px;
        }
        .btn-coffee:hover {
            background:#2e4129;
            transform:translateY(-2px);
        }

        /* ===== RELATED PRODUCTS ===== */
        .related-card {
            background:white;
            border-radius:14px;
            border:1px solid #e9dfcc;
            box-shadow:0 4px 14px rgba(0,0,0,0.12);
            overflow:hidden;
            transition:.2s ease;
        }
        .related-card:hover {
            transform:translateY(-4px);
            box-shadow:0 6px 16px rgba(0,0,0,0.2);
        }

        .related-img {
            width:100%;
            height:180px;
            object-fit:cover;
        }

        /* ===== REVIEW SECTION ===== */
        #review-section {
            background:white;
            padding:30px;
            margin-top:60px;
            border-radius:18px;
            border:1px solid #e6ddc8;
            box-shadow:0 6px 18px rgba(0,0,0,.12);
        }

        .review-box {
            background:#fffdf8;
            border-radius:12px;
            padding:15px;
            border:1px solid #e6ddc8;
            box-shadow:0 3px 8px rgba(0,0,0,.1);
        }

        textarea.form-control {
            border-radius:12px;
            border:1px solid #d6c8b7;
        }

        select.form-select {
            border-radius:12px;
            border:1px solid #d6c8b7;
        }

        hr {
            border-color:#e6ddc8;
        }

    </style>
</head>

<body>

<!-- ‚≠ê‚≠ê HEADER ‚≠ê‚≠ê -->
<div th:replace="layout/header :: header"></div>

<div class="container mt-4">

    <a href="/products" class="btn btn-secondary mb-3">‚¨Ö Tr·ªü v·ªÅ</a>

    <div class="product-box">

        <div class="row">

            <!-- ·∫¢NH S·∫¢N PH·∫®M -->
            <div class="col-md-5">
                <img th:src="@{'/img/' + ${product.image}}" class="product-img">
            </div>

            <!-- TH√îNG TIN S·∫¢N PH·∫®M -->
            <div class="col-md-7">
                <h2 th:text="${product.name}"></h2>

                <h4 th:text="${#numbers.formatDecimal(product.price,0,'COMMA',0,'POINT')} + ' ƒë'"></h4>

                <p class="mt-3" th:text="${product.description}"></p>

                <!-- FORM TH√äM GI·ªé H√ÄNG -->
                <form th:action="@{/cart/add}" method="post" class="mt-3">

                    <input type="hidden" name="productId" th:value="${product.id}">
                    <input type="hidden" name="quantity" value="1">

                    <!-- SIZE -->
                    <label class="mt-2">Size</label>
                    <select name="size" class="form-select w-50">
                        <option value="M">Size M</option>
                        <option value="L">Size L (+6.000ƒë)</option>
                    </select>

                    <!-- ƒê∆Ø·ªúNG -->
                    <label class="mt-3">ƒê·ªô ng·ªçt</label>
                    <select name="sugar" class="form-select w-50">
                        <option>0%</option>
                        <option>50%</option>
                        <option selected>100%</option>
                    </select>

                    <!-- ƒê√Å -->
                    <label class="mt-3">ƒê√°</label>
                    <select name="ice" class="form-select w-50">
                        <option>Kh√¥ng ƒë√°</option>
                        <option>√çt ƒë√°</option>
                        <option selected>B√¨nh th∆∞·ªùng</option>
                        <option>Nhi·ªÅu ƒë√°</option>
                    </select>

                    <!-- TOPPING -->
                    <label class="mt-3">Topping</label>
                    <div th:each="t : ${toppings}">
                        <label class="form-check-label">
                            <input class="form-check-input" type="checkbox" name="toppingIds" th:value="${t.id}">
                            <span th:text="${t.name}"></span>
                            (+<span th:text="${t.price}"></span> ƒë)
                        </label>
                        <br/>
                    </div>

                    <button type="submit" class="btn-coffee btn btn-lg mt-3">
                        üõí Th√™m v√†o gi·ªè h√†ng
                    </button>

                </form>

            </div>
        </div>

    </div>

    <!-- ==================== S·∫¢N PH·∫®M LI√äN QUAN ==================== -->
    <h3 class="mt-5 mb-3">S·∫£n ph·∫©m li√™n quan</h3>

    <div class="row mt-3" th:if="${related != null}">
        <div class="col-md-3 mb-4" th:each="r : ${related}">

            <div class="related-card">

                <img th:src="@{'/img/' + ${r.image}}" class="related-img">

                <div class="p-3">
                    <h6 class="fw-bold" th:text="${r.name}"></h6>

                    <p class="text-danger fw-bold"
                       th:text="${#numbers.formatDecimal(r.price,0,'COMMA',0,'POINT')} + ' ƒë'">
                    </p>

                    <a th:href="@{/product/{id}(id=${r.id})}"
                       class="btn btn-coffee btn-sm w-100">
                        Xem chi ti·∫øt
                    </a>
                </div>

            </div>

        </div>
    </div>

</div>


<!-- ==================== ƒê√ÅNH GI√Å ==================== -->
<div class="container" id="review-section">

    <h3 class="mb-4">üí¨ ƒê√°nh gi√° s·∫£n ph·∫©m</h3>

    <!-- ƒêI·ªÇM TRUNG B√åNH -->
    <div class="mb-3">
        <strong>ƒêi·ªÉm trung b√¨nh: </strong>

        <span th:each="i : ${#numbers.sequence(1,5)}">
            <span th:text="${i <= avgRating} ? '‚≠ê' : '‚òÜ'"
                  style="font-size:24px;"></span>
        </span>

        <span class="text-muted ms-2"
              th:text="'(' + ${reviewCount} + ' ƒë√°nh gi√°)'"></span>
    </div>

    <hr>

    <!-- FORM REVIEW -->
    <h5 class="fw-bold mt-3">Vi·∫øt ƒë√°nh gi√°</h5>

    <form action="/review/add" method="post" class="mb-4">

        <input type="hidden" name="productId" th:value="${product.id}">

        <label class="mt-2">S·ªë sao</label>
        <select name="rating" class="form-select w-25 mb-2">
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - Tuy·ªát v·ªùi</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê - Ngon</option>
            <option value="3">‚≠ê‚≠ê‚≠ê - T·∫°m ·ªïn</option>
            <option value="2">‚≠ê‚≠ê - Kh√¥ng ngon l·∫Øm</option>
            <option value="1">‚≠ê - T·ªá</option>
        </select>

        <textarea name="comment" class="form-control mb-2" rows="3"
                  placeholder="C·∫£m nh·∫≠n c·ªßa b·∫°n..."></textarea>

        <button type="submit" class="btn-coffee btn">
            G·ª≠i ƒë√°nh gi√°
        </button>

    </form>

    <hr>

    <!-- LIST REVIEW -->
    <div th:if="${#lists.isEmpty(reviews)}">
        <p class="text-muted">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!</p>
    </div>

    <div th:if="${!#lists.isEmpty(reviews)}">
        <div th:each="rv : ${reviews}" class="review-box mb-3">

            <div>
                <span th:each="i : ${#numbers.sequence(1, rv.rating)}"
                      style="font-size:20px;">‚≠ê</span>
            </div>

            <p class="mt-2 mb-1" th:text="${rv.comment}"></p>

            <small class="fw-semibold" th:text="${rv.user.fullName}"></small>
            <br>
            <small class="text-muted"
                   th:text="${#temporals.format(rv.createdAt, 'dd/MM/yyyy HH:mm')}"></small>

        </div>
    </div>

</div>

<!-- FOOTER -->
<div th:replace="layout/footer :: footer"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
